#!/bin/bash

cve="$1"

if [[ ! -d /exploits ]]; then
  echo "ERROR: /exploits is not mounted!" 1>&2
  exit 1
fi

if [[ ! -d "/exploits/$cve" ]]; then
  num_of_exploits=$(ls -d /exploits/${cve}* | wc -l)
  if [ $num_of_exploits -lt 1 ]; then
    echo "ERROR: no exploits found for ${cve}!" 1>&2
    exit 1
  fi
fi

for f in $(ls -d /exploits/${cve}*)
do
   pushd $f
   ./test_exploit 0 172.17.0.2 80 -1 172.17.0.1 5000
   exit_code=$?
   popd;
   if [[ $exit_code != 0 ]]; then
     echo "ERROR: unexpected exit code from exploit ($exit_code)" 1>&2
     exit $exit_code
   fi
done
