#!/bin/bash

# Check for error conditions:
if [[ $# != 1 ]]; then
  echo "usage: $0 <exploit-dirname>" 1>&2
  exit 1
fi

if [[ ! -d /app ]]; then
  echo "error: the dockerized app needs to be mounted as /app!" 1>&2
  exit 1
fi

exploit_dir="/app/$1"

if [[ ! -d "$exploit_dir" ]]; then
  echo "error: exploit path $exploit_dir not found on docker!" 1>&2
  exit 1
fi

# Run the specified exploit
pushd "$exploit_dir"
./test_exploit 0 172.17.0.2 80 -1 172.17.0.1 5000
exit_code=$?
popd

if [[ $exit_code != 0 ]]; then
  echo "error: unexpected exit code ($exit_code) returned from the exploit" \
       "found under ${exploit_dir}!" 1>&2
  exit $exit_code
fi
